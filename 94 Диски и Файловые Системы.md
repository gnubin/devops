
## Диски и файловая система  

**Что такое блочные устройства? Какие элементарные операции можно с ними производить?**

- Ответ
    
    Блочное устройство представляет собой уровень абстракции, описывающий любое устройство хранения информации, которое может быть разбито на блоки определенного размера; доступ к каждому блоку осуществляется независимо от доступа к другим блокам. 
    Такой доступ часто называют произвольным доступом.
    Иными словами блочные устройства нужны тогда, когда используется передача большого объема данных.
    - Сюда входят RAM-диски, компакт диски, накопители на магнитах
    - Доступ также осуществляется через спец файлы интерфейсы в `dev`.
    - На блочных устройствах как правило файловые системы.
    - Блочные устройства представлены часто как множество блоков.
    - Один блок кратен степени двух и равен килобайту данных.
    - Это позволяет линуксу читать и писать как в символьные устройства, так и в блочные.
    - Разница в том, что передается блок данных, а не байт.
    - Для пользователя это незаметно.
    - Используется для монтирования файловых систем.
    
    Через `lsblk` можно посмотреть такие устройства.  
    Данные передаются блоками. Как правило, кратный размер 256 байт  
    Можно записывать считывать, разделы создавать.  
    
    Блочные устройства не работают напрямую с системными вызовами. 
    И в случае блочных устройств их взаимосвязь обеспечивается системой управления файлами и подсистемой плочного устройства. 
    Эти подсистемы нужны чтобы подготовить ресурсы (буферы) драйвера устройства. Сохранять недавно прочитанные устйроства в кэш буфере, упорядочивание операций чтения и записи для повышения производительности.
    
    

### Что такое символьные устройства? Какие элементарные операции с ними можно производить?  

- Ответ
  Один из типов устройств. 
  Используется для медленных устройств, у которых происходит обмен небольшим объемом данных. И доступ к ним не требует частых поисковых запросов.
  Примеры таких устройств: мышь, клавиатура, последовательные порты. 
  В этом случае данные передаются последовательно, байт за байтом.
  
  Для этих устройств системные вызовы идут напрямую к драйверам устройств.
    

---

### Что такое major and minor numbers блочных устройств, чему они соответствуют?  

- Ответ
    
    На примере вывода:
    
    ```bash
    crw-rw-rw- 1 root   root    1, 3   Feb 23 1999  null
     crw------- 1 root   root   10, 1   Feb 23 1999  psaux
     crw------- 1 rubini tty     4, 1   Aug 16 22:22 tty1
     crw-rw-rw- 1 root   dialout 4, 64  Jun 30 11:19 ttyS0
     crw-rw-rw- 1 root   dialout 4, 65  Aug 16 00:00 ttyS1
     crw------- 1 root   sys     7, 1   Feb 23 1999  vcs1
     crw------- 1 root   sys     7, 129 Feb 23 1999  vcsa1
     crw-rw-rw- 1 root   root    1, 5   Feb 23 1999  zero
    ```
    
    Цифры 1, 10, 4 и 7 - старшие, мажорные номера.
    
    Цифры 1, 3, 5, 64, 65 и 129 - минорные номера
    
    Старший номер идентифицирует драйвер, который связан с устройством.
    
    `null` и `zero` управляются драйвером 1.
    
    `tty1`, `ttyS0`, `ttyS1` - управляются драйвером четыре. Это виртуальные консоли и терминалы.
    
    Как правило один старший номер - один драйвер
    
    Младший же номер используется ядром что бы определить о каком устройстве идет речь.
    И можно получить ссылку на устройство через ядро. Само ядро ничего про них не знает, знают только то, что здесь ссылаются на устройства, которыми драйвер управляют.
    
    

---

### Что такое файловая система? Для чего она нужна?

- Ответ

    **Файловая система** — это способ организации данных на диске, который разделяет данные на отдельные части, называемые файлами. Она также управляет метаданными этих файлов, такими как их имена, разрешения и другие атрибуты.
    
    Операционная система должна поддерживать файловую систему, чтобы она могла отображать её содержимое, открывать файлы и сохранять их. Если операционная система не распознаёт файловую систему, вы можете установить специальный драйвер, который обеспечит её поддержку.
    
    #### Файловая система как система хранения
    
    Файловую систему на компьютере можно сравнить с системой хранения документов. Биты данных на компьютере называются "файлами", и они организованы в "файловую систему", как бумажные файлы организуются в файловые шкафы. Файловые системы обеспечивают различные методы организации этих файлов и хранения данных, и каждый из них имеет свои особенности.
    
    Существуют разные виды файловых систем, и каждая операционная система может поддерживать разные типы для работы с файлами.
    
    Для более подробного объяснения, можно ознакомиться с материалом по ссылке:  
    [Подробнее о файловых системах](https://windows-school.ru/blog/kompjuteru_nuzhna_fajlovaja_sistema/2018-08-03-155)


---

### Как создать файловую систему на блочном устройстве? Какие параметры можно задать при создании?

- Ответ

    Создание файловой системы на блочном устройстве можно сделать с помощью команды `mkfs` (make file system).  
    Эта команда обычно используется вместе с типом файловой системы, который вы хотите создать, например, ext4, ext3, xfs и т.д.

    Вот пример команды, которая создает файловую систему ext4 на блочном устройстве `/dev/sdb1`:

    ```bash
    mkfs -t ext4 /dev/sdb1
    ```

    При создании файловой системы можно задать различные параметры, в зависимости от типа файловой системы. Например, для файловой системы ext4 можно задать следующие параметры:

    - `-L label` : задает метку для файловой системы.
    - `-m reserved-blocks-percentage` : задает процент блоков, зарезервированных для суперпользователя.
    - `-E extended-options` : задает расширенные параметры, такие как stride, stripe-width и т.д.
    - `-b block-size` : задает размер блока в байтах (по умолчанию 4096).
    - `-N number-of-inodes` : задает количество индексных дескрипторов (inode) в файловой системе.

    Но для той или иной файловой системы команды и ключи могут быть другими. Так что смотрите какая фс.

    
---

### Что такое **inodes айноды**

- Ответ
    
    **Inode** (индексный дескриптор) - структура данных, в которой хранятся метаданные файла и перечислены блоки с данными файла. 
    
    Хранит всю информацию, кроме имени файла и данных. 
    Каждый файл в данном каталоге ( по факту таблица с индексами ( inumber ) ) является записью с именем файла и номером индекса.
    
    Вся остальная информация о файле извлекается из таблицы индексов путем ссылки на номер индекса. 
    Номера inodes уникальны на уровне раздела. Каждый раздел имеет собственную таблицу индексов. 
    Если у вас закончились inode, вы не можете создавать новые файлы, даже если у вас есть свободное 
    место на данном разделе.
    
    Inodes хранят метаданные о файле, к которому они относятся. 
    Эти метаданные содержат всю информацию об указанном файле:
    
    - Размер.
    - Разрешение.
    - Владелец/группа.
    - Расположение жесткого диска.
    - Дата/время.
    - Любая другая необходимая информация.
    
    Чтобы увеличить количество inode, нужно увеличить размер файловой системы, 
    ведь количество инодов фиксированное и оно задается при создании файловой системы. 
    Значит увеличение файловой системы = увеличение количества инодов.
    
    Существуют файловые системы с динамическим количеством инодов, одна из которых - XFS.
    
    Динамические иноды отличаются от статических тем, что они динамически создаются по 
    мере необходимости и могут делать это автоматически, но это требует более сложных механизмов отслеживания.
    

---

### Где физически находятся inodes айноды

- Ответ
    
    Будет зависеть от файловой системы. Например, в ext2, ext3 хранится перед блоками данных. Это атрибут не диска, а файловой системы.
    
    иноды хранятся в таблицах инодов, и в каждой группе блоков в разделе есть таблица инодов.
    
    Может быть каталог инодов и имен, которые с ним связаны. Но это также будет зависеть от файловой системы. В fat32 их нет
    
    ![partition-images](https://github.com/Swfuse/devops-interview/blob/main/imgs/Untitled%202.png)
    
- Краткий ответ
    
    Имена inodes (имена файлов, каталогов, устройств и т. Д.) Хранятся на диске в каталогах. В каталоге хранятся только имена и соответствующие номера inode; Фактическое дисковое пространство для именованных данных хранится в пронумерованном индексном узле, а не в каталоге.
    
    Айнода просто указывает на файл и каталог

---

### По какой причине и на какого типа системах айноды могут закончиться? И к чему это может привести?

- Ответ
    
    Не будет возможности создания файла
    
    Зависит от размера блока, на который жесткий диск бьется. И от размера жесткого диска. И также могут разные файловые системы так работать.
    
---

### Какая файловая система бывает  динамическими айнодами и что это такое, зачем нужно?

- Ответ
    Динамические айноды это тот подход, при котором количество айнод не фиксируется при создании файловой системы.   
    Что позволяет изменить их до нужного нам количества.  
    
    В отличие от других файловых систем, где это нужно заранее резервировать.  
    Поскольку в этом случае придется создавать новую файловую систему, раздел с нужным нам количеством данных.  

    Как правило такие файловые системы хорошо подходят для систем, где ожидается большое количество файлов.
  
    Примеры таких файловых систем:  
    XFS, ZFS, BTRFS
    
---

### Где хранится информация об именах файлов, директорий?

- Ответ
    - Inodes не содержат имён файлов, только другие метаданные файла.
    - Каталоги Unix представляют собой списки ассоциативных структур, каждая из которых содержит одно имя файла и один номер индекса.
    - Драйвер файловой системы должен найти каталог, ищущий определенное имя файла, а затем преобразовать имя файла в правильный соответствующий номер индекса.
    
    Таким образом имя файла/директории хранится в информационной структуре каталогов.
    
    ![https://github.com/rmntrvn/adm_linux_ops_questions/raw/master/questions/imgs/inf_struct_catalogs.gif](https://github.com/rmntrvn/adm_linux_ops_questions/raw/master/questions/imgs/inf_struct_catalogs.gif)
    

---

### Каким образом осуществляется монтирование ФС? Как можно посмотреть список примонтированных ФС? (2 - 3 способа)

- Ответ
    
    ```bash
    mkfs -t ext3 /dev/hda8
    ```
    
    `mount` - показать все файловые системы
    
    `mount -t ext4` - покажет ext4 файловые системы
    
    Если нужно примонтировать usb
    
    Создаем файлик и монтируем
    
    ```bash
    sudo mkdir -p /media/usb
    sudo mount /dev/sdd1 /media/usb
    ```
    

    

---

### Что такое псевдофайловая система?

- Ответ
    
    «Псевдо» означает ложь, притворяться. Таким образом, «псевдофайловая система» означает файловую систему, которая не имеет *фактических* файлов - скорее, она имеет виртуальные записи, которые сама файловая система создает на месте.
    
    Можно сказать это интерфейс ядра linux.
    
    Например, `/proc` во многих ОС - это procfs, который динамически генерирует каталоги для каждого процесса. 
    Точно так же `/sys` в Linux генерирует файлы и каталоги для представления аппаратных схем. Есть FUSE на основе псевдо-файловая система для *многих* вещей.
    
    `/dev` может быть реальной файловой системой (просто подкаталогом `/`) или виртуальной псевдофайловой системой (например, devfs), или средней точкой, такой как Linux devtmpfs (которая является полной файловой системой в памяти, но все же создает узлы устройства из нигде).
    
    Основное предназначение современных VFS — организация единого интерфейса доступа пользователя к различным файловым системам, [драйверы](https://ru.wikipedia.org/wiki/%D0%94%D1%80%D0%B0%D0%B9%D0%B2%D0%B5%D1%80)
     которых загружены в память компьютера. Для реализации этой цели от ядра [операционной системы](https://ru.wikipedia.org/wiki/%D0%9E%D0%BF%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0)
     требуется создание единого [программного интерфейса](https://ru.wikipedia.org/wiki/API)
     внутренних вызовов ядра

   Если говорить о том, где хранится `proc`, то это **представление** структуры ядра. И можно сказать, что содержимое хранится в памяти ядра, то есть в ОЗУ.
    

---

### Какие проблемы могут возникать с файловой системой и жёстким диском? Можно ли восстановить ФС при незначительном повреждении её структуры? Как это сделать?  

- Ответ
    
    #### Восстановление файловых систем и инструменты для проверки

    Если автоматическая проверка при загрузке не может восстановить согласованность файловой системы, система обычно переходит в однопользовательский режим и выводит сообщение с указаниями для ручного запуска утилиты `fsck`. Для файловой системы **ext2**, которая не поддерживает журналирование, вам может быть предложена серия вопросов для подтверждения операций восстановления. Рекомендуется следовать предложениям `fsck`, отвечая "y" для подтверждения операций. После перезагрузки системы обязательно проверьте, не пропали ли какие-либо файлы или данные.
    
    #### Ручная проверка файловой системы
    
    Если вы подозреваете порчу данных или хотите вручную проверить файловую систему, большинство утилит требует предварительного размонтирования файловой системы. Однако размонтировать корневую файловую систему работающей системы невозможно. В этом случае можно перейти в однопользовательский режим (используя команду `telinit 1`), затем перемонтировать корневую файловую систему в режиме «только чтение» и выполнить проверку согласованности. Лучший способ проверки файловых систем — это загрузка с резервной системы (например, с CD-диска или USB-накопителя) и проведение проверки в размонтированном состоянии.
    
    #### Продвинутые инструменты
    
    Существуют более функциональные инструменты для проверки и восстановления файловых систем. Правила их использования можно найти в документации (`man`), а также в **Linux Documentation Project**. Большинство этих команд требуют размонтированной файловой системы, хотя некоторые функции могут работать и с файловыми системами, смонтированными в режиме «только чтение».
    
    **Важно**: перед любыми операциями по восстановлению обязательно создавайте резервную копию файловой системы.
    
    #### Инструменты для файловых систем ext2 и ext3

    - **tune2fs**  
    Настраивает параметры файловых систем **ext2** и **ext3**. Может добавлять журнал к системе ext2, преобразуя её в **ext3**, а также выводит или задаёт максимальное число монтирований перед проверкой. Можно также задать метку и управлять дополнительными опциями.
  
    - **dumpe2fs**  
      Выводит информацию о суперблоках и группах блоков в файловых системах **ext2** и **ext3**.

    - **debugfs**  
      Интерактивная утилита для отладки файловых систем **ext2** и **ext3**. Используется для проверки и изменения состояния файловой системы.

    #### Инструменты для файловых систем ReiserFS

    - **reiserfstune**  
    Выводит и настраивает параметры файловой системы **ReiserFS**.

    - **debugreiserfs**  
      Выполняет функции, аналогичные `dumpe2fs` и `debugfs`, для файловой системы **ReiserFS**.

    #### Инструменты для файловой системы XFS

    - **xfs_info**  
    Выводит информацию о файловой системе **XFS**.

    - **xfs_growfs**  
      Расширяет файловую систему **XFS**, если имеется дополнительное дисковое пространство.

    - **xfs_admin**  
      Изменяет параметры файловой системы **XFS**.

    - **xfs_repair**  
      Восстанавливает файловую систему **XFS**, если стандартные проверки при монтировании не могут восстановить её целостность.

    - **xfs_db**  
      Проверяет и отлаживает файловую систему **XFS**.

    

---

### Какую файловую систему выбрать ext4 или xfs?
- Ответ
    XFS поддерживает очень большие разделы и файлы.
    Также она хорошо работает при многопоточной нагрузке параллельной записи и чтения.
    Не очень подходит для однопоточных нагрузок с большим количеством метаданных. Например если один поток создает и удаляет большое количество мелких файлов.xfs поддерживает динамические inod-ы. В xfs они динамические, и их можно добавить.
    Ограничение системного раздела - 500TB
    В xfs можно потерять все данные, если сбилось что-то в момент записи на диск.
    Да и развернуть бэкап может не получиться, xfs разный может быть на серверах.

    ext4 поддерживает разделы до 50TB. Позволяет уменьшить созданный раздел.
    Лучше себя проявляет на медленных дисках с точки зрения пропускной способности. 


    Итог:
    Если много потоков последовательной записи или чтения с большим потреблением cpu в виде мелких файлов, и много метаданных то лучше ext4.

    Если у нас параллельная нагрузка в несколько потоков с большими файлами - лучше xfs.

    https://access.redhat.com/articles/3129891

    По своему опыту скажу - что xfs дисковые аварии в облаках плохо переживает. Потом сложно будет диск привести в рабочее состояние. То и дело будут отвалы, и проверки будут показывать ошибки. 
    


---

### Как определить, на каком физическом жёстком диске находится раздел с файловой системой? Как можно идентифицировать этот носитель без выключения сервера?

- Ответ

  Посмотреть название блочного устройства нужного можно например с помощью команды:
  `mount | grep " $(stat -c%m /home) " | awk '{print $1}'`
  
  А дальше на основе полученной информации можно выудить фирму, серийный номер и размер диска.
  `smartctl -a /dev/sda | grep -e "Serial Number" -e "Device Model" -e "Model Family" -e "User Capacity"`
  
  
  
  
  
  
    
---

**Какую файловую систему Вы бы выбрали для работы с большим количеством файлов?**

- Ответ
   ext4, она лучше справляется с большим количеством файлов, метаданных
    

---

### Как узнать, какими процессами используется раздел? 

- Ответ
    
    `lsof | grep /media/whatever`
    
    `fuser -mv /path/to/mountpoint`
    

---

### Для чего необходимы файлы /etc/fstab, /etc/mtab, /etc/mdadm/mdadm.conf?

- Ответ
    
    При включении главный диск смонтирован в корень. Загрузочный в boot. 
    
    Дополнительные диски можно увидеть в `mnt/*`  
    Информация об этих монтированиях хранится в файле `/etc/fstab`  
    
    Система автоматом монтирует диски на основании тех данных, которые берет их этого файла.
    
    То есть монтирование происходит во время загрузки
    
    `/etc/mtab` – это файл, который содержит список уже смонтированных файловых систем.
    
    Поэтому, когда вы запускаете команду «df», она обращается к этому файлу для генерации вывода.
    
    Файл mtab содержит софт ссылку на файл /proc/self/mounts.
    
    [https://zalinux.ru/?p=4895](https://zalinux.ru/?p=4895)
    
    mdadm - настройки подсистемы софтового рейда
    

---

### Отличие хардлинков от симлинков hardlinks symlinks

- **Ответ определения**
    
    Хардлинк - жесткая ссылка. По своей сути является тем же файлом на который ссылается. Также счетчик в айнодах есть. Цифра 1 это оно. Счетчик имен одного и того же файла.
    
    ```
    ls -lih | grep file
    475949 -rw-r--r--  1 root     setevoy     0B Aug 13 11:51 file1
    475950 -rw-r--r--  1 root     setevoy     0B Aug 13 11:51 file2
    475951 -rw-r--r--  1 root     setevoy     0B Aug 13 11:51 file3
    ```
    
    Симлинк - магкая ссылка. При ее создании создается новый объект на существующий файл файловой системы.
    
    Отличить можно по наличию буквы l в выводе команды ls например:
    
    ```
    ls -lih | grep sym
    475948 lrwxr-xr-x  1 root     setevoy     5B Aug 13 12:02 symlink1 -> file1
    ```
    
- **Ключевые отличия**
    - `hardlink` не может указывать на файл в другой файловой системе (так как `inode` может принадлежать только одной ФС), а `symlink` – может.  
    - при редактировании файла-ссылки в случае с `hardlink`ом – изменятся оба файла, так как это один и тот же объект, а в случае с `symlink`а – можно изменять его имя, атрибуты, направить его на другой файл и при этом оригинальный файл не будет затронут (но учтите, что если вы откроете файл симлинка для редактирования – то измените оригинальный файл, т.к. по сути вы откроете для редактирования именно его)
    - жёсткая ссылка не может указывать на на каталог
    - При удалении `hardlink`
    -а – файл будет существовать до тех пор, пока есть хотя бы 1 `hardlink`
     на него, но может “менять каталог размещения”, если был удалён “исходный” файл, но остался файл-`hardlink`
     в другом месте. При удалении же файла, на который указывает `symlink`
     – файл-ссылка просто станет нерабочим.

---

### Что такое RAID? Какие основные типы RAID существуют, чем они отличаются?

- Ответ
    
    **RAID** (Redundant Array of Independent Disks/Избыточный массив независимых дисков) - это технология, 
    которая позволяет объеденить несколько независимых физических дисков в одну сущность.

    В работе с дисками есть две проблемы
    
    - Низкая скорость чтения\записи
    - Выход дисков из строя и потеря данных
    
    И это всё решается с помощью технологии RAID.
    
    Существуют следующие уровни спецификации RAID: 1,2,3,4,5,6,0. Кроме того, существуют комбинации: 01,10,50,05,60,06.  Существуют аппаратные и программные RAID-массивы.
    
    - Программные массивы создаются уже после установки Операционной Системы средствами программных продуктов и утилит, что и является главным недостатком таких дисковых массивов.
    - Аппаратные RAID’ы создают дисковый массив до установки Операционной системы и от неё не зависят.
    
    **RAID 0** - чередование
    
    **RAID 1** - зеркалирование
    
    **RAID 5** - чередование с четностью
    
    **RAID 6** - чередование с двойной четностью
    
    **RAID 10** - совмещение зеркалирования и чередования
    
    **Уровень RAID 0 - Чередование**
    
    В системе **RAID 0** данные разделяются на блоки, которые записываются на все диски в массиве. При одновременном использовании нескольких дисков (как минимум 2) это обеспечивает превосходную производительность ввода-вывода. Достигается это за счёт того что данные передаются контроллерам дисков по быстрой шине одновременно, и диски записывают данные на свои блины или чипы одновременно. Таким образом, эффективная скорость записи может вырасти кратно до числа дисков. Эту производительность можно повысить, используя несколько контроллеров, в идеале один контроллер на диск.
    
    ![raid-0-img](https://github.com/Swfuse/devops-interview/blob/main/imgs/Untitled%203.png)
    
    **Преимущества**
    
    - RAID 0 обеспечивает высокую производительность как в операциях чтения, так и записи. Нет никаких накладных расходов, вызванных контролем четности.
    - Используется весь объем памяти, накладных расходов нет.
    - Технология проста в реализации.
    
    **Недостатки**
    
    - RAID 0 не отказоустойчив.
    - В случае сбоя одного диска все данные в массиве RAID 0 будут потеряны.
    - Он не должен использоваться для критически важных систем.
    
    **Лучшее применение:**
    
    RAID 0 идеально подходит для некритического хранения данных, которые должны считываться/записываться с высокой скоростью, например, на ретушь изображений или на станции видеомонтажа.
    
    Если вы хотите использовать RAID 0 исключительно для объединения емкости хранилищ в одном томе, рассмотрите возможность подключения одного диска в путь к папке другого диска. Это поддерживается в Linux, OS X, а также Windows и имеет то преимущество, что сбой одного диска не влияет на данные второго диска.
    
    **Уровень RAID 1 - Зеркальное отображение**
    
    Данные хранятся дважды, записывая их как на основной диск (или набор дисков), так и на зеркальный диск (или набор дисков). В случае сбоя диска контроллер использует основной диск или зеркальный диск для восстановления данных и продолжает работу. Вам нужно как минимум 2 диска для массива RAID 1.
    
    ![raid-1-img](https://github.com/Swfuse/devops-interview/blob/main/imgs/Untitled%204.png)
    
    **Преимущества**
    
    - RAID 1 предлагает отличную скорость чтения и скорость записи, сопоставимую с одиночным диском.
    - В случае сбоя диска данные не нужно перестраивать, их просто нужно скопировать на новый диск.
    - RAID 1 - очень простая технология.
    
    **Недостатки**
    
    - Основным недостатком является то, что эффективная емкость хранилища составляет только половину от общей емкости диска, поскольку все данные записываются дважды.
    - Программные решения RAID 1 не всегда допускают горячую замену неисправного диска. Это означает, что неисправный диск можно заменить только после выключения компьютера, к которому он подключен.
    - Для серверов, которые используются одновременно многими людьми, это может быть неприемлемо. Такие системы обычно используют аппаратные контроллеры, которые поддерживают горячую замену.
    
    **Идеальное использование**
    
    RAID-1 идеально подходит для критически важных хранилищ, например, для учетных систем. Он также подходит для небольших серверов, в которых будут использоваться только два диска с данными.
    
    **RAID уровень 5**
    
    RAID 5 является наиболее распространенным безопасным уровнем RAID.  Требуется как минимум 3 диска, но может работать до 16. Блоки данных распределяются по дискам, и на одном диске записывается контрольная сумма четности всех данных блока.  Данные о четности не записываются на фиксированный диск, они распространяются на все диски, как показано на рисунке ниже.  Используя данные контроля четности, компьютер может пересчитать данные одного из других блоков данных, если эти данные больше не будут доступны.  Это означает, что массив RAID 5 может противостоять отказу одного диска без потери данных или доступа к ним.  Хотя RAID 5 может быть реализован программно, рекомендуется аппаратный контроллер.  Часто дополнительная кеш-память используется на этих контроллерах для улучшения производительности записи.
    
    ![raid-5-img](https://github.com/Swfuse/devops-interview/blob/main/imgs/Untitled%205.png)
    
    **Преимущества**
    
    - Транзакции чтения данных очень быстрые, в то время как транзакции записи данных несколько медленнее (из-за четности, которая должна быть рассчитана).
    - В случае сбоя диска у вас по-прежнему есть доступ ко всем данным, даже если неисправный диск заменяется, а контроллер хранилища восстанавливает данные на новом диске.
    
    **Недостатки**
    
    - Отказы дисков влияют на пропускную способность, хотя это все еще допустимо.
    - Это сложная технология. Если один из дисков в массиве, использующий диски 4 ТБ, выходит из строя и заменяется, восстановление данных (время восстановления) может занять день или более, в зависимости от нагрузки на массив и скорости контроллера. Если другой диск выйдет из строя в течение этого времени, данные будут потеряны навсегда.
    - При этом нагрузка на каждый из дисков возрастает, поэтому вероятность выхода из строя выше чем у любых других схем, а при выходе из строя одного диска алгоритм восстановления крайне активно работает со всеми дисками, что потенциально может привести к лавинообразному выходу из строя последующих дисков.
    
    **Идеальное использование**
    
    RAID 5 — это хорошая универсальная система, которая сочетает в себе эффективное хранилище с превосходной безопасностью и достойной производительностью. Он идеально подходит для файловых серверов и серверов приложений с ограниченным количеством дисков с данными.
    
    **Уровень RAID 6 - Чередование с двойной четностью**
    
    RAID 6 похож на RAID 5, но данные о четности записываются на два диска. Это означает, что для него требуется как минимум 4 диска и он может выдержать 2 диска, умирающих одновременно. Вероятность поломки двух дисков в один и тот же момент, конечно, очень мала. Тем не менее, если диск в системах RAID 5 умирает и заменяется новым, для восстановления замененного диска требуются часы или даже больше дня. Если в это время умирает другой диск, вы все равно теряете все свои данные. При использовании RAID 6 массив RAID переживет даже этот второй сбой.
    
    ![raid-6-img](https://github.com/Swfuse/devops-interview/blob/main/imgs/Untitled%206.png)
    
    **Преимущества**
    
    - Как и в RAID 5, операции чтения данных выполняются очень быстро.
    - Если два диска выйдут из строя, у вас все равно будет доступ ко всем данным, даже если вышедшие из строя диски заменяются. Таким образом, RAID 6 более безопасен, чем RAID 5.
    
    **Недостатки**
    
    - Операции записи данных выполняются медленнее RAID 5 из-за дополнительных данных о четности, которые необходимо рассчитать. Производительность записи теоретичски может быть на 20% ниже.
    - Отказы дисков влияют на пропускную способность, хотя это все еще допустимо.
    - Это сложная технология. Восстановление массива, в котором вышел из строя один диск, может занять много времени.
    
    **Идеальное использование**
    
    RAID 6 — это хорошая универсальная система, которая сочетает в себе эффективное хранилище с превосходной безопасностью и достойной производительностью. Это предпочтительнее, чем RAID 5 на файловых серверах и серверах приложений, которые используют много больших дисков для хранения данных.
    
    **RAID уровень 10 - объединение RAID 1 и RAID 0**
    
    Можно объединить преимущества (и недостатки) RAID 0 и RAID 1 в одной системе. Это вложенная или гибридная конфигурация RAID. Он обеспечивает безопасность путем зеркального отображения всех данных на вторичных дисках, в то же время используя распределение по каждому набору дисков для ускорения передачи данных.
    
    ![raid-10-img](https://github.com/Swfuse/devops-interview/blob/main/imgs/Untitled%207.png)
    
    **Преимущества**
    
    Если что-то идет не так с одним из дисков в конфигурации RAID 10, время восстановления очень быстрое, поскольку все, что нужно, - это скопировать все данные с выжившего зеркала на новый диск. Это может занять всего 30 минут для дисков емкостью 1 ТБ.
    
    **Недостатки**
    
    Половина емкости хранения уходит на зеркалирование, поэтому по сравнению с большими массивами RAID 5 или RAID 6 это дорогой способ обеспечения избыточности.
    
    **Как насчет уровней RAID 2, 3, 4 и 7?**
    
    Эти уровни существуют, но они не являются общими (RAID 3 по сути похож на RAID 5, но данные четности всегда записываются на один и тот же диск). В этой статье описывается лишь общая классификация RAID-систем, и отображает общие сведения о технологии объединения накопителей.
    
    **RAID не заменит резервную копию!**
    
    Все уровни RAID, кроме RAID 0, обеспечивают защиту от сбоя одного диска. Система RAID 6 продолжит работу, даже при выходе из строя одновременно 2 дисков. Для полной безопасности вам все равно необходимо выполнить резервное копирование данных из системы RAID.
    
    - Эта резервная копия пригодится, если все диски выйдут из строя одновременно из-за скачка мощности.
    - Это защита от кражи системы хранения.
    - Резервные копии могут храниться вне серверной комнаты или ЦОД, в другом месте. Это может пригодиться в случае чрезвычайного происшествия, масштабного системного сбоя, пожара и т.д.
    - Наиболее важной причиной резервного копирования данных нескольких поколений является ошибка пользователя. Если кто-то случайно удаляет некоторые важные данные, и это остается незамеченным в течение нескольких часов, дней или недель, хороший набор резервных копий гарантирует, что вы все равно сможете сохранить эти файлы.

---

### Какие средства для работы с программными RAID массивами существуют в linux?

- Ответ
    
    `mdadm`
    
    [https://www.dmosk.ru/miniinstruktions.php?mini=mdadm](https://www.dmosk.ru/miniinstruktions.php?mini=mdadm)
    

---

### Что такое LVM? Для решения каких задач он предназначен?

- Ответ
    
    менеджер, позволяющий управлять логическими томами в системах Linux. Сами логические тома можно собрать из нескольких дисков или разделов дисков. LVM расшифровывается как Logical Volume Manager или по-русски — менеджер логических томов.
    
    LVM или Logical Volume Manager - это еще один программный уровень абстракции над физическими разделами жесткого диска, который позволяет создавать логические тома для хранения данных без непосредственной переразметки жесткого диска на одном или нескольких жестких дисках. LVM увеличивает удобство работы с жестким диском, аппаратные особенности работы скрываются программным обеспечением, поэтому вы можете изменять размеры дисков, перемещать их на лету, без остановки приложений или размонтирования файловых систем. Это очень удобно на серверах, вы можете добавить еще один диск или расширить существующие lvm тома на лету.
    

---

### Что такое loop devices? Как их можно использовать?

- Ответ
    
    В Unix-подобных операционных системах устройство цикла , vnd (диск vnode) или lofi (интерфейс файла цикла) является псевдоустройством, которое делает компьютерный файл доступным как блочное устройство . 
    
    Перед использованием петлевое устройство должно быть подключено к существующему файлу в файловой системе. Ассоциация предоставляет пользователю интерфейс прикладного программирования ( API ), который позволяет использовать файл вместо блочного специального файла (см. Файловую систему устройства ). Таким образом, если файл содержит всю файловую систему, файл может быть смонтирован, как если бы это было дисковое устройство. 
    
    Файлы этого типа часто используются для CD образов ISO и дискет образов. Монтирование файла, содержащего файловую систему, с помощью такого монтирования цикла делает файлы в этой файловой системе доступными. Они появляются в каталоге точки монтирования . Петлевое устройство - 
    
    Петлевое подключение имеет несколько применений. Это удобный метод автономного управления и редактирования образов файловой системы, которые в дальнейшем используются для нормальной работы системы. Сюда входят образы CD или DVD или системы установки. Его можно использовать для установки операционной системы в файловую систему без повторного разбиения диска. Он также обеспечивает постоянное разделение данных, например, при имитации съемных носителей на более быстром и удобном жестком диске или инкапсуляции зашифрованной файловой системы. Петлевое устройство - [https://ru.xcv.wiki/wiki/Loop_device](https://ru.xcv.wiki/wiki/Loop_device)
    

---

### При создании нового файла система возвращает ошибку no space left device

**no space left on device
несмотря на то, что df
сообщает о наличии свободного места. При каких обстоятельствах может возникнуть описанная ситуация?(inodes)**

- Ответ
    
    ```bash
    Сначала смотрим свободное место
    df
    
    Потом иноды, поскольку айноды тоже имеют свойство заканчиваться
    df -i
    
    ```
    

---

### df сообщает о наличии 20 Гб занятого пространства, подсчёт занятого файлами места при помощи du даёт результат в 20 Мб. При каких обстоятельствах может возникнуть описанная ситуация?(deleted files)

- Ответ
    
    При удаленном файле такое может быть. Файловый дескриптор держит файл
    
    Ищем файл через 
    
    `lsof -a +L1 | grep var | grep httpd`
    
    При удалении файла, который в этот момент был «занят» процессом — его имя удаляется, но inode — остаётся в файловой системе до тех пор, пока не завершится процесс, который «держит» этот файл.
    
    Соответственно, что бы «освободить» уже удалённые файлы — необходимо перезапустить процесс, который этот файл держит.
    

---

### При создании нового файла пользователем система возвращает ошибку no space left on device 
несмотря на то, что df сообщает о наличии свободного места; при это
пользователь root может создавать и записывать файлы. При каких обстоятельствах может
возникнуть описанная ситуация?(quotas)**

- Ответ
    
    Бывает так, что превышается квота
    Для каждого юзера и пользователя она своя может быть, жестко заданная
    
    ```bash
    #посмотреть квоту юзера
    quota -v user
    ```
    

---
