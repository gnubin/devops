Файловые системы. Работа с файлами и текстом

**Краткая теория и справка с командами по работе с ФС**
[https://tproger.ru/articles/kak-ustroena-fajlovaya-sistema-v-linux](https://tproger.ru/articles/kak-ustroena-fajlovaya-sistema-v-linux)  

**Типы файловых систем**

![](https://img2.teletype.in/files/18/b7/18b726e0-e23a-4aab-835a-f92ea9bb94d9.png)

Частый вопрос на собеседовании:  
**Какую файловую систему выбрать ext4 или xfs?**

XFS поддерживает очень большие разделы и файлы. Также она хорошо работает при многопоточной нагрузке параллельной записи и чтения. Не очень подходит для однопоточных нагрузок с большим количеством метаданных. Например если один поток создает и удаляет большое количество мелких файлов.xfs поддерживает динамические inod-ы. В xfs они динамические, и их можно добавить. Ограничение системного раздела - 500TB В xfs можно потерять все данные, если сбилось что-то в момент записи на диск. Да и развернуть бэкап может не получиться, xfs разный может быть на серверах.

ext4 поддерживает разделы до 50TB. Позволяет уменьшить созданный раздел. Лучше себя проявляет на медленных дисках с точки зрения пропускной способности.

Итог: Если много потоков последовательной записи или чтения с большим потреблением cpu в виде мелких файлов, и много метаданных то лучше ext4.

Если у нас параллельная нагрузка в несколько потоков с большими файлами - лучше xfs.

**Файловый дескриптор** - неотрицательное целое число, которое используется в интерфейсе между пространством пользователя и пространством ядра (kernel) для идентификации ресурсов файла / сокета. Когда создаётся новый поток ввода-вывода, ядро возвращает процессу, создавшему поток ввода-вывода, его файловый дескриптор.

**Inode** (индексный дескриптор) - структура данных, в которой хранятся метаданные файла и перечислены блоки с данными файла.

Гайд по разделам дисков и создание разделов с описанием основных утилит - [https://wiki.merionet.ru/articles/sozdanie-i-formatirovanie-razdelov-zhestkih-diskov-v-linux](https://wiki.merionet.ru/articles/sozdanie-i-formatirovanie-razdelov-zhestkih-diskov-v-linux)

- жесткая ссылка (то есть hard link) — путь файла, заданный командой ls -li;
- символьная ссылка (symbolic link) — файл стандарта UNIX с текстовой строкой, задающей путь к оригинальному файлу.

Существует также суперблок, где хранятся все параметры ФС — общее количество блоков и Inode, наличие свободных блоков и данные о них. Суперблок должен сохранять целостность — это напрямую влияет на стабильность и работу всей системы. Для безопасности в Линукс создается несколько копий для восстановления информации в случае ее потери.

Рассмотрим типы файлов, которые используются в Linux:

- Обычные (regular). Это стандартные файлы, используемые чаще других — данные, текст, исходный код, медиа и все остальное;
- Файлы устройств. Сюда входят символьные и блочные файлы (char и block devices), представляющие внешние устройства — принтеры, жесткий диск и другие;
- Именованные каналы. Файлы named pipes требуются для взаимодействия между процессами и передачи данных;
- Ссылки. Используется два типа ссылок. Символические (так называемые симлинки) — работают как ярлыки для указания других каталогов и файлов; жесткие — отвечают за альтернативные способы доступа к физическим данным на диске и выступают дубликатами файлов, но без их фактического дублирования;
- Каталоги. Папки со ссылками на файлы и другие папки. Отвечают за организацию данных и их распределение по категориям, упрощают доступ к различным разделам;
- Сокеты. Файлы, предназначенные для обмена данными при выполнении рабочих задач. Используются как внутри системы, так и при взаимодействии устройств друг с другом. По сути, это своего рода почтовые службы, с помощью которых программы пересылают информацию друг другу;
- Двери. Еще один механизм, ответственный за взаимодействие между процессами.

Монтирование — подключение файловых систем, жестких дисков и внешних носителей, получение доступа к ним, ручное и автоматическое отключение. При загрузке ядро устройства на Linux автоматически монтирует разделы, считывая данные из конфигурации /etc/fstab.

Какие файловые системы на Linux наиболее востребованные:

- Ext. Первая ФС, разработанная специально для Линукс. Система значительно превзошла предыдущие решения по производительности и функционалу;
- Ext2. Улучшенная версия первой ФС. Повышает надежность, улучшает управление и позволяет работать с большим количеством данных и файлов;
- Ext3. Третье поколение ФС для Линукс. Поддерживает журналирование, что делает работу более стабильной и минимизирует риски потери данных после сбоев системы;
- Ext4. Новейшая версия с повышенной эффективностью и масштабируемостью. Технически более совершенный вариант, упрощающий работу с большим объемом данных; 
- JFS. Разработка компании IBM. Эффективно использует ресурсы, отличается высокой производительностью, рассчитана на сильные нагрузки;
- XFS. Высокопроизводительная ФС, разработанная компанией SGI. Подходит для работы с серверами и системами хранения данных; 
- ReiserFS. Разработка программиста Ганса Райзера. Главная особенность — возможность при необходимости увеличивать размер блока, тем самым избегая фрагментации;
- Btrfs. Продукт компании Oracle. Обеспечивает гибкость при управлении данными, предоставляет опции оперативной проверки и восстановления файлов, интегрирует разные устройства в единую ФС; 
- Swap. Позволяет использовать дисковое пространство как виртуальную память, если физические возможности RAM исчерпаны. Технически этот инструмент нельзя назвать файловой системой, но он обеспечивает широкие возможности для управления данными в Линукс.
 
![[rr-atyy5ru2por4kcyrmd-x87n8.jpeg]]


**Файловый дескриптор** - неотрицательное целое число, которое используется в интерфейсе между пространством пользователя и пространством ядра (kernel) для идентификации ресурсов файла / сокета. Когда создаётся новый поток ввода-вывода, ядро возвращает процессу, создавшему поток ввода-вывода, его файловый дескриптор.

**Inode** (индексный дескриптор) - структура данных, в которой хранятся метаданные файла и перечислены блоки с данными файла.